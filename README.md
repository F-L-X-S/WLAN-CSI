# 
## Realtime calculation and evaluation of channel state information for IEEE802.11n WLAN 

### Objective
Provision of synchronized CSI-datastreams, generated by several SDR-Receivers for processing of AoA/TDoA algorithms matched to received packets. 

### Roadmap DoA for wireless signals according IEEE802.11n
1) Realtime generation of CSI-Data with a single receiver
    1) Algorithm for calculating CSI from raw IQ-Data in Gnuradio / Matlab 
    2) Deployment on Raspberry-PI for decentralized CSI-calculation
2) CSI-Evaluation for multiple receivers
    1) Synchronization of SDRs and Raspberry-PI
    2) Datatransfer from multiple Raspberry-PIs to PC
    3) Dataformatting for pyespargos-compatibility 
    4) additionally: AoA / TDoA implementation
3) Localization of RF-Emitter with TDoA/AoA
    1) Design of an antenna array

### Hardware
For establishing a WLAN-transmission with known transmission-properties, it is advisable, to use a board with an **ESP32** chip. The ESP32 is able to transmit wireless signals compliant to IEEE 802.11n (IEEE 802.11-2012), which is the reason, why the focus below is on this standard and not on the latest one. <br>
As described below, the relevant signal is distributed to different carriers, that are spread over the channel-bandwidth (20MHz or 40MHz). The SDR has to provide a sample-rate of at least 20MSPS to sample all subcarriers, carrying the training-field-signal of the 20MHz transmission. 
#### HackRF
Provides 2-20MS/s 
#### USRP N210 
Provides 100MS/s

## Channel Frequency Response and Channel State Information
A received signal can be described as the convolution of the transmitted signal $s(t)$ and the channel-impulse-response (CIR) $h(t)$:
$$r(t)=s(t)\circledast h(t)$$ 
Therefore the channel-frequency-response (transfer-function of the channel) is defined as  [^1]:
$$H(\omega)=\frac{R(\omega)}{S(\omega)}$$

### Channel State Information in OFDM-systems
Orthogonal frequency division multiplexing (OFDM) divides the allocated bandwidth into a number of subcarriers for transmitting data in parallel, but with a lower symbol-rate in each steam. Aim of this procedure is, to reduce the likelihood of symbol-interference within the seperated streams. The attenuation and phase of a single subcarrier represent a sample of the CFR at the center-frequency of the respective subcarrier:<br>
$$H(f_j)=||H(f_j)||e^{\angle H(f_j)}$$
<br>
All CFR-samples in total are handles as the channel-state-information  [^1]:<br>
$$H=\{ H(f_j)|j\in [1, J]|, J\in \mathbb{N} \}$$
<br>

### Estimation of CSI for OFDM-signals according to IEEE802.11n
WLAN-transmissions use orthogonal frequency division multiplexing and divide the 20MHz channel into 64 subcarriers and the 40MHz channel into 128 subcarriers ([^2], chapter 2.3.7, S.1691). The original serial datastream is divided into parallel streams, each with a lower transmission-rate. A single Symbol of a parallelized stream is called OFDM-symbol. 
<br>

The IEEE 802.11n introduces the PLCP (physical layer convergence protocol), that adds a preamble and a PLCP-header to the PSDU (PLCP Service Data Unit). The composition of the whole PPDU (PLCP Protocol data unit) depends on the used transmision-mode (non-HT, mixed-HT and HT) (high-throughput) ([^2],  Figure 20-1, S.1682).

IEEE802.11n defines training-fields (predefined complex OFDM-Symbols) as a part of the PPDU-preamble, that are transmitted on a subset of the respective subcarriers. The training-fields are used by the receiver for channel-estimation, time-synchronization, gain-control and carrier-offset. The OFDM-Symbols, transmitted by each subcarrier are defined in IEEE Std 802.11-2012 chapter 2.3.9.
<br>
Because the OFDM-Symbols are predefined by the standardization, the spectrum of the sent signal $S(\omega)$ is known. According to the definition of the CSI as samples of the CFR on the respective center-frequency of each subcarrier, the CSI can be calculated by handling the vector, containing the complex scaling-factors of the training-fields, as the spectrum of the transmitted signal $S(f_j)$. The spectrum of the during the preamble-transmission received signal, sampled at the each subcarrier represents $R(f_j)$

The receivers have to be synchronized for DoA-estimation, because
<br>
$$\mathcal{F} \{ r(t-\tau) \}=\mathcal{F} \{ r(t) \}*e^{-j\omega \tau}$$
<br>
### References
[^1]: Zheng Yang, Yi Zhang, Guoxuan Chi, Guidong Zhang, "Hands-on Wireless Sensing with Wi-Fi: A Tutorial" tns.thss.tsinghua.edu.cn, 2023, https://tns.thss.tsinghua.edu.cn/wst/docs/pre/
(accessed April 4, 2025)

[^2]: "IEEE Standard for Information technology--Telecommunications and information exchange between systems Local and metropolitan area networks--Specific requirements Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications," in IEEE Std 802.11-2012 (Revision of IEEE Std 802.11-2007) , vol., no., pp.1-2793, 29 March 2012, doi: 10.1109/IEEESTD.2012.6178212.