% This MATLAB-script copares the results of the autocorrelation-function in
% C++ and the AutoCorr-function in MATLAB. 
% Simlply run the example_auto_corr.cc and copy x and rxx from terminal.
% Make sure to check, that Windowsize and delay for 
% the MATLAB and C++ calculation are equal.

% Window-size for MATLAB-coputation
window_size = 3;  

% lag (delay) for MATLAB-computation 
lag = 3;

% Input-signal with repeating QPSK-Symbols generated by signal_generator in example_auto_correlation.cc
x = [ ...
0.063074 + 1i*0.003053, 0.089401 + 1i*0.039922, -0.036160 + 1i*-0.086183, 0.065918 + 1i*-0.030798, -0.040287 + 1i*-0.006882,  ...
-0.087695 + 1i*-0.127173, -0.028273 + 1i*-0.089282, 0.002347 + 1i*-0.030563, 0.110553 + 1i*0.033984, -0.026128 + 1i*0.048801,  ...
0.002725 + 1i*-0.067610, -0.006290 + 1i*0.007104, 0.117536 + 1i*-0.012939, 0.001202 + 1i*-0.056980, 0.058748 + 1i*0.028865,  ...
0.050762 + 1i*-0.044919, -0.105011 + 1i*0.044341, -0.051064 + 1i*0.007192, -0.018680 + 1i*0.118387, 0.050677 + 1i*0.087572,  ...
0.067928 + 1i*-0.050898, 0.028645 + 1i*0.011459, -0.031642 + 1i*-0.000899, -0.034171 + 1i*0.073778, -0.011588 + 1i*0.000439,  ...
0.096857 + 1i*0.062095, 0.020720 + 1i*0.010353, -0.062090 + 1i*0.055337, 0.097082 + 1i*-0.058392, -0.077729 + 1i*0.017659,  ...
-0.683654 + 1i*-0.699473, -0.700498 + 1i*0.655330, -0.676440 + 1i*0.737915, 0.630340 + 1i*-0.895631, 0.681298 + 1i*-0.734433,  ...
0.698592 + 1i*0.652429, 0.708888 + 1i*0.705606, 0.665293 + 1i*-0.593924, -0.809071 + 1i*-0.715630, -0.665982 + 1i*0.647389,  ...
0.758310 + 1i*0.628091, -0.805838 + 1i*0.765166, 0.629887 + 1i*0.722887, 0.755723 + 1i*-0.606549, -0.830314 + 1i*-0.766656,  ...
-0.661196 + 1i*-0.697432, -0.786256 + 1i*-0.706351, -0.707336 + 1i*0.685738, -0.647720 + 1i*0.658439, 0.744590 + 1i*-0.764530,  ...
0.738513 + 1i*-0.575372, 0.746666 + 1i*0.749461, 0.683283 + 1i*0.860085, 0.500194 + 1i*-0.583495, -0.754609 + 1i*-0.891250,  ...
-0.705503 + 1i*0.732377, 0.653267 + 1i*0.826269, -0.727097 + 1i*0.678830, 0.649552 + 1i*0.582062, 0.632808 + 1i*-0.643832,  ...
-0.657114 + 1i*-0.640493, -0.665875 + 1i*-0.767307, -0.637313 + 1i*-0.727189, -0.661367 + 1i*0.768549, -0.718008 + 1i*0.714144,  ...
0.578809 + 1i*-0.762529, 0.590032 + 1i*-0.698643, 0.792126 + 1i*0.685900, 0.751788 + 1i*0.843913, 0.633603 + 1i*-0.784663,  ...
-0.790671 + 1i*-0.824049, -0.684538 + 1i*0.641955, 0.590291 + 1i*0.724533, -0.678985 + 1i*0.800074, 0.860958 + 1i*0.597780,  ...
0.765041 + 1i*-0.635238, -0.726741 + 1i*-0.694701, -0.599820 + 1i*-0.800919, -0.626181 + 1i*-0.575608, -0.814902 + 1i*0.828853,  ...
-0.629646 + 1i*0.795091, 0.659604 + 1i*-0.693405, 0.609150 + 1i*-0.676837, 0.748975 + 1i*0.687941, 0.721283 + 1i*0.770994,  ...
0.759355 + 1i*-0.740763, -0.631580 + 1i*-0.797405, -0.793784 + 1i*0.703862, 0.736525 + 1i*0.642020, -0.758533 + 1i*0.719540,  ...
0.692104 + 1i*0.690570, 0.748126 + 1i*-0.787992, -0.725161 + 1i*-0.765412, -0.696196 + 1i*-0.710320, -0.009812 + 1i*0.038910,  ...
-0.078477 + 1i*-0.007137, -0.129180 + 1i*0.077465, 0.052973 + 1i*-0.051941, -0.011498 + 1i*-0.089871, -0.008018 + 1i*-0.036562,  ...
-0.012715 + 1i*-0.045396, 0.054269 + 1i*0.006542, -0.034358 + 1i*-0.005439, 0.080455 + 1i*0.034932, -0.057970 + 1i*0.004034,  ...
-0.026319 + 1i*-0.057852, 0.109930 + 1i*-0.063498, 0.029242 + 1i*-0.024186, 0.050043 + 1i*0.059872, 0.089117 + 1i*-0.005965,  ...
-0.116825 + 1i*0.041213, -0.106916 + 1i*-0.009876, -0.032998 + 1i*0.013131, 0.030385 + 1i*-0.081729, 0.024032 + 1i*0.097451,  ...
0.001692 + 1i*0.002444, -0.050562 + 1i*-0.045344, 0.272519 + 1i*0.001505, -0.007195 + 1i*-0.050184, -0.092900 + 1i*0.052817,  ...
-0.026118 + 1i*-0.056017, 0.065019 + 1i*-0.107737, 0.027838 + 1i*-0.051625, 0.133766 + 1i*0.075452, -0.035618 + 1i*-0.037725,  ...
0.028198 + 1i*0.120953, -0.121384 + 1i*0.101939, 0.020949 + 1i*-0.007166, -0.011689 + 1i*0.096349, -0.012873 + 1i*0.059275,  ...
0.010611 + 1i*-0.049115, -0.018627 + 1i*0.090938, 0.127741 + 1i*0.009098, 0.127786 + 1i*-0.013510, 0.050380 + 1i*-0.107543,  ...
-0.113201 + 1i*0.084280, 0.031641 + 1i*0.063955, 0.023772 + 1i*0.036305, -0.000496 + 1i*0.011005, 0.096823 + 1i*0.071880,  ...
-0.081610 + 1i*-0.092238, 0.016711 + 1i*-0.057833, 0.001112 + 1i*-0.060161, -0.042354 + 1i*-0.047096, -0.138273 + 1i*-0.098113,  ...
-0.050999 + 1i*0.110575, 0.044203 + 1i*0.040190, -0.051364 + 1i*-0.008507, -0.065411 + 1i*-0.040361, -0.030665 + 1i*-0.100779,  ...
0.073468 + 1i*0.118526, 0.054290 + 1i*-0.065436, -0.042596 + 1i*-0.015893, -0.022161 + 1i*0.050334, -0.139153 + 1i*-0.025232,  ...
-0.091959 + 1i*-0.056846, -0.073559 + 1i*0.034137, -0.079703 + 1i*0.084633, -0.091303 + 1i*0.031667, -0.065642 + 1i*0.055828,  ...
0.099556 + 1i*0.053325, -0.002458 + 1i*0.099717, -0.028197 + 1i*-0.056419, -0.010933 + 1i*-0.080852, 0.053809 + 1i*-0.019467,  ...
0.081886 + 1i*-0.032324, -0.103242 + 1i*0.026208, -0.042926 + 1i*-0.068932, -0.075211 + 1i*-0.058826, 0.006829 + 1i*0.009448,  ...
-0.035174 + 1i*0.052594, -0.077493 + 1i*-0.011182, 0.043081 + 1i*0.004059, -0.070853 + 1i*-0.088986, 0.067641 + 1i*-0.038386,  ...
0.112952 + 1i*-0.021483, 0.065862 + 1i*-0.098268, -0.058115 + 1i*0.016587, 0.044512 + 1i*0.006216, -0.036126 + 1i*-0.130284,  ...
-0.054187 + 1i*0.022789, 0.000790 + 1i*-0.073519, -0.003087 + 1i*-0.008689, 0.002740 + 1i*-0.112870, 0.132808 + 1i*0.003551,  ...
0.073432 + 1i*0.040320, 0.110566 + 1i*-0.076878, -0.001032 + 1i*-0.049450, 0.090985 + 1i*0.003627, -0.072754 + 1i*-0.008485,  ...
-0.158226 + 1i*-0.044917, 0.020684 + 1i*0.094843, -0.068200 + 1i*-0.069814, -0.016325 + 1i*-0.062474, -0.014879 + 1i*0.077235,  ...
-0.031267 + 1i*0.032506, -0.022655 + 1i*0.057044, 0.171799 + 1i*0.131193, 0.013073 + 1i*-0.079686, 0.115583 + 1i*0.041841 ...
];

% Autocorrelation-result calculated in example_auto_correlation.cc
Rxx = [ ...
0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.004064 + 1i*-0.002144, 0.000187 + 1i*-0.001151,  ...
0.014318 + 1i*-0.004110, 0.011141 + 1i*-0.008722, 0.015133 + 1i*-0.008468, -0.013015 + 1i*0.005571, -0.017519 + 1i*0.008614,  ...
-0.015562 + 1i*0.007291, -0.002000 + 1i*-0.002789, -0.002084 + 1i*-0.004474, -0.000301 + 1i*-0.004473, -0.000011 + 1i*-0.006071,  ...
0.010239 + 1i*-0.005296, 0.003730 + 1i*-0.011152, 0.001102 + 1i*-0.008657, -0.011711 + 1i*0.001137, -0.010497 + 1i*-0.004376,  ...
-0.011539 + 1i*-0.004162, -0.004452 + 1i*-0.012938, -0.004696 + 1i*0.001231, -0.006937 + 1i*0.002393, -0.008086 + 1i*0.006143,  ...
-0.009524 + 1i*0.001540, -0.003392 + 1i*-0.003615, -0.002321 + 1i*-0.004374, 0.006577 + 1i*-0.014180, 0.005093 + 1i*-0.011127,  ...
0.008091 + 1i*0.070748, -0.103958 + 1i*0.105149, -0.036921 + 1i*0.058567, 0.154874 + 1i*1.030512, -0.697399 + 1i*1.075788,  ...
-0.754127 + 1i*0.164370, -1.134786 + 1i*0.190837, 0.713219 + 1i*0.206818, -0.327771 + 1i*1.191575, -0.157952 + 1i*1.040748,  ...
-0.915951 + 1i*1.825017, 0.220560 + 1i*0.601335, 0.284360 + 1i*-1.216724, 0.345003 + 1i*-3.019582, 0.323079 + 1i*-0.570698,  ...
-0.646060 + 1i*0.357180, -1.003919 + 1i*0.281087, -1.024813 + 1i*-2.083704, -0.135117 + 1i*-3.009468, -0.014773 + 1i*-0.871701,  ...
-0.993291 + 1i*0.140515, -0.952499 + 1i*0.050538, -1.055884 + 1i*0.086282, 0.566175 + 1i*0.042605, -0.675067 + 1i*0.919764,  ...
-0.378422 + 1i*0.864176, -1.238913 + 1i*1.801770, -0.063848 + 1i*0.741410, -0.243669 + 1i*-1.252166, -0.206890 + 1i*-2.990103,  ...
-0.107558 + 1i*-0.918057, -0.954726 + 1i*-0.142520, -0.771251 + 1i*-0.069550, -0.871907 + 1i*-1.909944, -0.062631 + 1i*-2.825583,  ...
0.058100 + 1i*-1.048215, -0.811412 + 1i*-0.110998, -0.820470 + 1i*-0.142709, -1.214457 + 1i*0.012143, 0.634758 + 1i*-0.016763,  ...
-0.477847 + 1i*0.930982, -0.242354 + 1i*0.929562, -1.358904 + 1i*1.872121, -0.289824 + 1i*0.790439, -0.522561 + 1i*-1.231766,  ...
-0.336710 + 1i*-3.083284, -0.276629 + 1i*-0.838034, -1.066213 + 1i*-0.207131, -1.170964 + 1i*-0.115996, -1.092181 + 1i*-2.337609,  ...
-0.356117 + 1i*-2.987818, -0.256612 + 1i*-1.335810, -1.330426 + 1i*-0.120676, -0.995910 + 1i*-0.168131, -1.040859 + 1i*0.026690,  ...
0.980473 + 1i*0.042753, -0.116519 + 1i*0.908669, -0.087537 + 1i*1.019663, -0.967775 + 1i*1.990051, -0.040860 + 1i*1.093492,  ...
-0.074307 + 1i*-1.061502, -0.112899 + 1i*-3.155301, -0.018895 + 1i*-0.993624, -0.927945 + 1i*0.030840, -1.011053 + 1i*1.112906,  ...
-0.947996 + 1i*-0.044359, 0.059280 + 1i*-0.179204, 0.094740 + 1i*-0.202133, 0.033912 + 1i*-0.140271, -0.002794 + 1i*0.010763,  ...
0.001432 + 1i*0.009250, -0.001324 + 1i*0.007081, 0.000947 + 1i*0.000524, -0.003346 + 1i*0.006798, -0.005254 + 1i*0.002594,  ...
-0.004509 + 1i*0.005651, 0.004726 + 1i*-0.006506, 0.006052 + 1i*-0.005820, 0.000053 + 1i*-0.006346, 0.003602 + 1i*0.007606,  ...
0.000982 + 1i*0.004702, -0.000179 + 1i*0.009290, -0.013374 + 1i*0.005260, -0.015879 + 1i*0.015176, -0.013469 + 1i*-0.000913,  ...
-0.010474 + 1i*-0.001989, -0.001386 + 1i*-0.015795, 0.008842 + 1i*-0.032134, 0.008731 + 1i*-0.032099, 0.008863 + 1i*-0.033471,  ...
-0.005035 + 1i*-0.022177, 0.000039 + 1i*-0.018071, -0.007576 + 1i*-0.007862, -0.008094 + 1i*0.012886, -0.011285 + 1i*0.002558,  ...
-0.011431 + 1i*0.004055, -0.012256 + 1i*0.021327, -0.014481 + 1i*0.028663, 0.002303 + 1i*0.027971, 0.018453 + 1i*-0.000707,  ...
0.019503 + 1i*-0.002705, 0.017159 + 1i*-0.006104, 0.008449 + 1i*-0.007910, 0.009894 + 1i*-0.000824, -0.009804 + 1i*-0.004134,  ...
-0.022392 + 1i*0.015351, -0.021233 + 1i*0.017818, -0.013221 + 1i*0.024782, 0.001456 + 1i*0.011782, 0.005938 + 1i*-0.000737,  ...
0.003356 + 1i*-0.004352, 0.001727 + 1i*-0.003303, -0.010150 + 1i*-0.005290, 0.002939 + 1i*-0.006123, 0.006947 + 1i*-0.015604,  ...
0.004455 + 1i*-0.012645, -0.007110 + 1i*-0.012202, -0.002537 + 1i*-0.006429, 0.003045 + 1i*0.005808, 0.001404 + 1i*0.002206,  ...
-0.011315 + 1i*0.000606, -0.011098 + 1i*-0.002214, -0.002784 + 1i*-0.002797, 0.006336 + 1i*0.008991, 0.001342 + 1i*-0.007956,  ...
0.003255 + 1i*-0.003191, 0.002265 + 1i*-0.006570, 0.017124 + 1i*-0.009882, 0.018900 + 1i*-0.018944, 0.022286 + 1i*-0.023756,  ...
0.009909 + 1i*-0.022644, 0.006695 + 1i*-0.023568, -0.001339 + 1i*-0.016425, -0.003317 + 1i*-0.011215, -0.008772 + 1i*-0.007506,  ...
-0.007959 + 1i*-0.007253, -0.003549 + 1i*-0.008420, -0.002443 + 1i*-0.007647, -0.006215 + 1i*-0.020427, -0.005683 + 1i*-0.012947,  ...
-0.006830 + 1i*-0.013085, 0.003913 + 1i*-0.009554, 0.004703 + 1i*-0.008779, 0.004631 + 1i*0.002760, -0.006668 + 1i*0.010208,  ...
-0.002222 + 1i*0.009203, 0.004044 + 1i*0.015170, 0.004289 + 1i*0.010331, 0.004404 + 1i*0.013373, 0.010750 + 1i*-0.011581,  ...
0.018845 + 1i*-0.010898, 0.013529 + 1i*-0.015834, 0.004349 + 1i*-0.003791, -0.001899 + 1i*0.002688, -0.001633 + 1i*0.015732,  ...
-0.003454 + 1i*0.016334, 0.008247 + 1i*0.022549, 0.008091 + 1i*0.006219, 0.015495 + 1i*0.002303, -0.000877 + 1i*-0.016497,  ...
0.001820 + 1i*-0.017711, -0.002781 + 1i*-0.005755, 0.010164 + 1i*0.005277, 0.013169 + 1i*0.022206, 0.017961 + 1i*0.016661,  ...
0.012270 + 1i*0.007761, 0.003687 + 1i*-0.003738, 0.004246 + 1i*-0.021967, 0.001384 + 1i*-0.015501, 0.004346 + 1i*-0.020696 ...
];

figure;
subplot(3,1,1); plot(real(x)); hold on;  plot(imag(x)); title('Input-signal'), legend('Real', 'Imag');grid on;
subplot(3,1,2); plot(abs(Rxx)); xlabel('Sample'); ylabel('|R_{xx}|'); title('Autocorrelation (C++)'); grid on;
subplot(3,1,3); AutoCorr(x,lag, window_size); xlabel('Sample'); ylabel('|R_{xx}|'); title('Autocorrelation (Matlab)'); grid on;



