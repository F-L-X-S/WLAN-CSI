% This MATLAB-script copares the results of the autocorrelation-function in
% C++ and the AutoCorr-function in MATLAB. 
% Simlply run the example_auto_corr.cc and copy x and rxx from terminal.
% Make sure to check, that Windowsize and delay for 
% the MATLAB and C++ calculation are equal.

% Window-size for MATLAB-coputation
window_size = 3;  

% lag (delay) for MATLAB-computation 
lag = 3;

% Input-signal with repeating QPSK-Symbols generated by signal_generator in example_auto_correlation.cc
x = [ ...
0.063074 + 1i*0.003053, 0.089401 + 1i*0.039922, -0.036160 + 1i*-0.086183, 0.065918 + 1i*-0.030798, -0.040287 + 1i*-0.006882,  ...
-0.087695 + 1i*-0.127173, -0.028273 + 1i*-0.089282, 0.002347 + 1i*-0.030563, 0.110553 + 1i*0.033984, -0.026128 + 1i*0.048801,  ...
0.002725 + 1i*-0.067610, -0.006290 + 1i*0.007104, 0.117536 + 1i*-0.012939, 0.001202 + 1i*-0.056980, 0.058748 + 1i*0.028865,  ...
0.050762 + 1i*-0.044919, -0.105011 + 1i*0.044341, -0.051064 + 1i*0.007192, -0.018680 + 1i*0.118387, 0.050677 + 1i*0.087572,  ...
0.067928 + 1i*-0.050898, 0.028645 + 1i*0.011459, -0.031642 + 1i*-0.000899, -0.034171 + 1i*0.073778, -0.011588 + 1i*0.000439,  ...
0.096857 + 1i*0.062095, 0.020720 + 1i*0.010353, -0.062090 + 1i*0.055337, 0.097082 + 1i*-0.058392, -0.077729 + 1i*0.017659,  ...
-0.683654 + 1i*-0.699473, -0.700498 + 1i*0.655330, -0.676440 + 1i*0.737915, 0.630340 + 1i*-0.895631, 0.681298 + 1i*-0.734433,  ...
0.698592 + 1i*0.652429, 0.708888 + 1i*0.705606, 0.665293 + 1i*-0.593924, -0.809071 + 1i*-0.715630, -0.665982 + 1i*0.647389,  ...
0.758310 + 1i*0.628091, -0.805838 + 1i*0.765166, 0.629887 + 1i*0.722887, 0.755723 + 1i*-0.606549, -0.830314 + 1i*-0.766656,  ...
-0.661196 + 1i*-0.697432, -0.786256 + 1i*-0.706351, -0.707336 + 1i*0.685738, -0.647720 + 1i*0.658439, 0.744590 + 1i*-0.764530,  ...
0.738513 + 1i*-0.575372, 0.746666 + 1i*0.749461, 0.683283 + 1i*0.860085, 0.500194 + 1i*-0.583495, -0.754609 + 1i*-0.891250,  ...
-0.705503 + 1i*0.732377, 0.653267 + 1i*0.826269, -0.727097 + 1i*0.678830, 0.649552 + 1i*0.582062, 0.632808 + 1i*-0.643832,  ...
-0.657114 + 1i*-0.640493, -0.665875 + 1i*-0.767307, -0.637313 + 1i*-0.727189, -0.661367 + 1i*0.768549, -0.718008 + 1i*0.714144,  ...
0.578809 + 1i*-0.762529, 0.590032 + 1i*-0.698643, 0.792126 + 1i*0.685900, 0.751788 + 1i*0.843913, 0.633603 + 1i*-0.784663,  ...
-0.790671 + 1i*-0.824049, -0.684538 + 1i*0.641955, 0.590291 + 1i*0.724533, -0.678985 + 1i*0.800074, 0.860958 + 1i*0.597780,  ...
0.765041 + 1i*-0.635238, -0.726741 + 1i*-0.694701, -0.599820 + 1i*-0.800919, -0.626181 + 1i*-0.575608, -0.814902 + 1i*0.828853,  ...
-0.629646 + 1i*0.795091, 0.659604 + 1i*-0.693405, 0.609150 + 1i*-0.676837, 0.748975 + 1i*0.687941, 0.721283 + 1i*0.770994,  ...
0.759355 + 1i*-0.740763, -0.631580 + 1i*-0.797405, -0.793784 + 1i*0.703862, 0.736525 + 1i*0.642020, -0.758533 + 1i*0.719540,  ...
0.692104 + 1i*0.690570, 0.748126 + 1i*-0.787992, -0.725161 + 1i*-0.765412, -0.696196 + 1i*-0.710320, -0.009812 + 1i*0.038910,  ...
-0.078477 + 1i*-0.007137, -0.129180 + 1i*0.077465, 0.052973 + 1i*-0.051941, -0.011498 + 1i*-0.089871, -0.008018 + 1i*-0.036562,  ...
-0.012715 + 1i*-0.045396, 0.054269 + 1i*0.006542, -0.034358 + 1i*-0.005439, 0.080455 + 1i*0.034932, -0.057970 + 1i*0.004034,  ...
-0.026319 + 1i*-0.057852, 0.109930 + 1i*-0.063498, 0.029242 + 1i*-0.024186, 0.050043 + 1i*0.059872, 0.089117 + 1i*-0.005965,  ...
-0.116825 + 1i*0.041213, -0.106916 + 1i*-0.009876, -0.032998 + 1i*0.013131, 0.030385 + 1i*-0.081729, 0.024032 + 1i*0.097451,  ...
0.001692 + 1i*0.002444, -0.050562 + 1i*-0.045344, 0.272519 + 1i*0.001505, -0.007195 + 1i*-0.050184, -0.092900 + 1i*0.052817,  ...
-0.026118 + 1i*-0.056017, 0.065019 + 1i*-0.107737, 0.027838 + 1i*-0.051625, 0.133766 + 1i*0.075452, -0.035618 + 1i*-0.037725,  ...
0.028198 + 1i*0.120953, -0.121384 + 1i*0.101939, 0.020949 + 1i*-0.007166, -0.011689 + 1i*0.096349, -0.012873 + 1i*0.059275,  ...
0.010611 + 1i*-0.049115, -0.018627 + 1i*0.090938, 0.127741 + 1i*0.009098, 0.127786 + 1i*-0.013510, 0.050380 + 1i*-0.107543,  ...
-0.113201 + 1i*0.084280, 0.031641 + 1i*0.063955, 0.023772 + 1i*0.036305, -0.000496 + 1i*0.011005, 0.096823 + 1i*0.071880,  ...
-0.081610 + 1i*-0.092238, 0.016711 + 1i*-0.057833, 0.001112 + 1i*-0.060161, -0.042354 + 1i*-0.047096, -0.138273 + 1i*-0.098113,  ...
-0.050999 + 1i*0.110575, 0.044203 + 1i*0.040190, -0.051364 + 1i*-0.008507, -0.065411 + 1i*-0.040361, -0.030665 + 1i*-0.100779,  ...
0.073468 + 1i*0.118526, 0.054290 + 1i*-0.065436, -0.042596 + 1i*-0.015893, -0.022161 + 1i*0.050334, -0.139153 + 1i*-0.025232,  ...
-0.091959 + 1i*-0.056846, -0.073559 + 1i*0.034137, -0.079703 + 1i*0.084633, -0.091303 + 1i*0.031667, -0.065642 + 1i*0.055828,  ...
0.099556 + 1i*0.053325, -0.002458 + 1i*0.099717, -0.028197 + 1i*-0.056419, -0.010933 + 1i*-0.080852, 0.053809 + 1i*-0.019467,  ...
0.081886 + 1i*-0.032324, -0.103242 + 1i*0.026208, -0.042926 + 1i*-0.068932, -0.075211 + 1i*-0.058826, 0.006829 + 1i*0.009448,  ...
-0.035174 + 1i*0.052594, -0.077493 + 1i*-0.011182, 0.043081 + 1i*0.004059, -0.070853 + 1i*-0.088986, 0.067641 + 1i*-0.038386,  ...
0.112952 + 1i*-0.021483, 0.065862 + 1i*-0.098268, -0.058115 + 1i*0.016587, 0.044512 + 1i*0.006216, -0.036126 + 1i*-0.130284,  ...
-0.054187 + 1i*0.022789, 0.000790 + 1i*-0.073519, -0.003087 + 1i*-0.008689, 0.002740 + 1i*-0.112870, 0.132808 + 1i*0.003551,  ...
0.073432 + 1i*0.040320, 0.110566 + 1i*-0.076878, -0.001032 + 1i*-0.049450, 0.090985 + 1i*0.003627, -0.072754 + 1i*-0.008485,  ...
-0.158226 + 1i*-0.044917, 0.020684 + 1i*0.094843, -0.068200 + 1i*-0.069814, -0.016325 + 1i*-0.062474, -0.014879 + 1i*0.077235,  ...
-0.031267 + 1i*0.032506, -0.022655 + 1i*0.057044, 0.171799 + 1i*0.131193, 0.013073 + 1i*-0.079686, 0.115583 + 1i*0.041841 ...
];

% Autocorrelation-result calculated in example_auto_correlation.cc
Rxx = [ ...
0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000,  ...
0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000,  ...
0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000, 0.000000 + 1i*0.000000,  ...
0.000000 + 1i*0.000000, -0.006488 + 1i*0.003117, -0.010766 + 1i*0.005799, -0.020294 + 1i*-0.000092, -0.019650 + 1i*0.007241,  ...
-0.022036 + 1i*0.009759, -0.026006 + 1i*0.012397, -0.025031 + 1i*0.009598, -0.027366 + 1i*0.008727, -0.028632 + 1i*0.009169,  ...
-0.028132 + 1i*0.002820, -0.028776 + 1i*0.004249, -0.027992 + 1i*0.004342, -0.015826 + 1i*-0.001265, -0.016926 + 1i*-0.005673,  ...
-0.077279 + 1i*-0.027031, -0.142274 + 1i*-0.025231, -0.032033 + 1i*-0.075844, -0.066384 + 1i*-0.037324, -0.156530 + 1i*-0.098371,  ...
-0.064636 + 1i*-0.133818, -0.050010 + 1i*-0.052325, -0.033790 + 1i*-0.079599, -0.008520 + 1i*-0.054883, 0.064335 + 1i*-0.026999,  ...
0.057090 + 1i*-0.035053, 0.026052 + 1i*0.095447, 0.047230 + 1i*0.102475, -0.034041 + 1i*0.098223, -0.082049 + 1i*-0.019082,  ...
-0.041871 + 1i*0.051212, 1.050082 + 1i*0.005505, 2.059950 + 1i*-0.013115, 2.880212 + 1i*0.066949, 4.072923 + 1i*0.210711,  ...
5.098316 + 1i*0.428037, 6.016364 + 1i*0.492572, 7.095376 + 1i*0.536135, 7.762452 + 1i*0.469653, 8.984546 + 1i*0.628799,  ...
9.858010 + 1i*0.570771, 10.880874 + 1i*0.794640, 12.016751 + 1i*0.679813, 12.826126 + 1i*0.568436, 13.775356 + 1i*0.469866,  ...
14.847847 + 1i*0.620809, 15.784187 + 1i*0.597860, 15.767329 + 1i*0.786516, 15.817288 + 1i*0.713238, 15.828562 + 1i*0.690870,  ...
15.688432 + 1i*0.380651, 15.600437 + 1i*0.053793, 15.695362 + 1i*-0.064156, 15.843631 + 1i*-0.261702, 15.939075 + 1i*-0.193363,  ...
16.021820 + 1i*-0.457276, 16.030931 + 1i*-0.377822, 16.000854 + 1i*-0.608504, 15.932318 + 1i*-0.738644, 16.009590 + 1i*-0.748566,  ...
16.033958 + 1i*-0.555264, 15.919812 + 1i*-0.592270, 15.958350 + 1i*-0.562141, 15.761257 + 1i*-0.772241, 15.942389 + 1i*-0.604028,  ...
16.027000 + 1i*-0.735451, 15.923573 + 1i*-0.508579, 15.918134 + 1i*-0.305886, 15.877767 + 1i*-0.193142, 15.831148 + 1i*-0.152246,  ...
16.118755 + 1i*-0.002979, 15.944147 + 1i*0.189903, 15.986273 + 1i*0.169218, 15.901926 + 1i*0.028985, 15.955841 + 1i*0.268126,  ...
16.057341 + 1i*0.561792, 16.237139 + 1i*0.343610, 16.373373 + 1i*0.405072, 16.345919 + 1i*0.200474, 15.512015 + 1i*0.258971,  ...
14.394089 + 1i*0.251718, 13.517118 + 1i*0.426875, 12.677549 + 1i*0.327729, 11.899088 + 1i*0.238978, 10.802791 + 1i*0.185896,  ...
9.565716 + 1i*0.192031, 8.539700 + 1i*0.110710, 7.409262 + 1i*-0.023283, 6.374763 + 1i*-0.135395, 5.434728 + 1i*0.059452,  ...
4.322346 + 1i*0.003947, 3.345899 + 1i*-0.296740, 2.313925 + 1i*-0.164183, 1.173072 + 1i*-0.221783, 0.128765 + 1i*-0.022796,  ...
0.147768 + 1i*0.011358, 0.098193 + 1i*-0.059493, -0.039456 + 1i*-0.112567, -0.104559 + 1i*-0.117789, -0.167417 + 1i*-0.054223,  ...
-0.136362 + 1i*-0.032312, -0.089490 + 1i*-0.011091, -0.111054 + 1i*-0.057960, -0.136571 + 1i*-0.032313, -0.102924 + 1i*0.059540,  ...
-0.061529 + 1i*0.022703, -0.035345 + 1i*-0.033519, -0.061239 + 1i*0.082435, -0.100088 + 1i*0.082928, -0.022012 + 1i*0.088286,  ...
0.037584 + 1i*0.031779, 0.053216 + 1i*0.020731, 0.042586 + 1i*0.021692, 0.038957 + 1i*0.017807, 0.027867 + 1i*0.021307,  ...
0.032370 + 1i*0.018053, 0.032664 + 1i*0.018210, 0.023091 + 1i*0.025261, 0.043096 + 1i*0.023088, 0.047610 + 1i*0.024705,  ...
0.068207 + 1i*0.015360, 0.062510 + 1i*0.012109, 0.055623 + 1i*0.010434, 0.048703 + 1i*0.014622, 0.064991 + 1i*0.011490,  ...
0.075418 + 1i*0.011452, 0.067103 + 1i*-0.003147, 0.042454 + 1i*0.010949, 0.044073 + 1i*0.008685, 0.034585 + 1i*0.026181,  ...
0.047032 + 1i*0.027031, 0.050058 + 1i*0.031843, 0.050051 + 1i*0.036473, 0.048199 + 1i*0.026580, 0.010838 + 1i*0.017162,  ...
-0.003241 + 1i*0.027732, -0.029870 + 1i*0.032415, -0.027825 + 1i*0.034534, -0.024159 + 1i*0.031613, -0.023786 + 1i*0.032877,  ...
-0.055151 + 1i*0.031673, -0.058683 + 1i*0.021896, -0.058385 + 1i*0.022353, -0.054124 + 1i*0.009706, -0.053424 + 1i*0.005540,  ...
-0.064585 + 1i*-0.006535, -0.060644 + 1i*-0.012949, -0.062653 + 1i*-0.016907, -0.061587 + 1i*-0.017676, -0.055598 + 1i*-0.009671,  ...
-0.052294 + 1i*0.012865, -0.047727 + 1i*0.013155, -0.033887 + 1i*0.003772, -0.027384 + 1i*0.002861, -0.028360 + 1i*0.000307,  ...
-0.024584 + 1i*-0.009443, -0.003832 + 1i*-0.013926, -0.009717 + 1i*-0.006124, -0.005374 + 1i*0.010160, -0.010759 + 1i*0.016980,  ...
-0.019524 + 1i*0.017541, 0.000791 + 1i*0.001851, -0.008564 + 1i*0.012419, -0.006656 + 1i*0.016116, 0.003023 + 1i*0.010559,  ...
0.002398 + 1i*0.007286, 0.004093 + 1i*-0.007952, 0.008662 + 1i*-0.021137, 0.014145 + 1i*-0.009551, -0.000191 + 1i*-0.003316,  ...
0.000367 + 1i*-0.003182, -0.011133 + 1i*0.001913, -0.018262 + 1i*0.009111, -0.011297 + 1i*0.010667, -0.003503 + 1i*-0.008295,  ...
-0.005090 + 1i*-0.018770, 0.003822 + 1i*-0.002717, 0.004874 + 1i*-0.000722, 0.002990 + 1i*-0.002574, 0.004413 + 1i*-0.001380,  ...
-0.009621 + 1i*-0.005132, -0.003734 + 1i*-0.007878, -0.015684 + 1i*0.010851, -0.015123 + 1i*0.010232, -0.027192 + 1i*0.018359 ...
];

figure;
subplot(3,1,1); plot(real(x)); hold on;  plot(imag(x)); title('Input-signal'), legend('Real', 'Imag');grid on;
subplot(3,1,2); plot(abs(Rxx)); xlabel('Sample'); ylabel('|R_{xx}|'); title('Autocorrelation (C++)'); grid on;
subplot(3,1,3); AutoCorr(x,lag, window_size); xlabel('Sample'); ylabel('|R_{xx}|'); title('Autocorrelation (Matlab)'); grid on;



